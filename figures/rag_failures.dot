
digraph RAGFailures {
    // Graph settings
    rankdir=TB;
    bgcolor="white";
    fontname="Helvetica";
    node [fontname="Helvetica", fontsize=11];
    edge [fontname="Helvetica", fontsize=9];

    // Define styles
    node [shape=box, style="rounded,filled"];

    // Main pipeline nodes (blue/lavender)
    query [label="User Query", fillcolor="#C1C1E8", color="#3333B2", penwidth=2];
    embedding [label="Embedding\nModel", fillcolor="#C1C1E8", color="#3333B2", penwidth=2];
    vectordb [label="Vector\nDatabase", fillcolor="#C1C1E8", color="#3333B2", penwidth=2];
    retrieval [label="Retrieved\nDocuments", fillcolor="#C1C1E8", color="#3333B2", penwidth=2];
    context [label="Context\nAssembly", fillcolor="#C1C1E8", color="#3333B2", penwidth=2];
    llm [label="LLM\nGeneration", fillcolor="#C1C1E8", color="#3333B2", penwidth=2];
    answer [label="Final\nAnswer", fillcolor="#E8F5E9", color="#2CA02C", penwidth=2];

    // Failure categories (red boxes)
    node [shape=box, style="filled,dashed", fillcolor="#FFEBEE", color="#D62728", penwidth=2];

    fail1 [label="RETRIEVAL FAILURES\n- Query mismatch\n- Wrong chunks\n- Missing info"];
    fail2 [label="CONTEXT FAILURES\n- Too much noise\n- Lost in middle\n- Contradictions"];
    fail3 [label="GENERATION FAILURES\n- Ignores context\n- Hallucinates anyway\n- Wrong synthesis"];

    // Main flow
    query -> embedding [penwidth=2, color="#3333B2"];
    embedding -> vectordb [penwidth=2, color="#3333B2", label="  query vector"];
    vectordb -> retrieval [penwidth=2, color="#3333B2", label="  top-k"];
    retrieval -> context [penwidth=2, color="#3333B2"];
    query -> context [penwidth=2, color="#FF7F0E", style=dashed, label="original query  "];
    context -> llm [penwidth=2, color="#3333B2"];
    llm -> answer [penwidth=2, color="#2CA02C"];

    // Failure connections (red arrows)
    edge [color="#D62728", style=dashed, penwidth=1.5];

    vectordb -> fail1 [label="X", fontcolor="#D62728", fontsize=14];
    context -> fail2 [label="X", fontcolor="#D62728", fontsize=14];
    llm -> fail3 [label="X", fontcolor="#D62728", fontsize=14];

    // Layout hints
    {rank=same; query}
    {rank=same; embedding}
    {rank=same; vectordb; fail1}
    {rank=same; retrieval}
    {rank=same; context; fail2}
    {rank=same; llm; fail3}
    {rank=same; answer}

    // Title
    labelloc="t";
    label="\nWhen RAG Fails: Failure Points in the Pipeline\n";
    fontsize=16;
    fontcolor="#3333B2";
}
