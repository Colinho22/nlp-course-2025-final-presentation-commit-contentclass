---
layout: default
---

<div class="reading-progress">
  <div class="progress-bar"></div>
</div>

<div class="module-layout">
  <!-- Sidebar with Table of Contents -->
  <aside class="sidebar">
    <nav class="toc">
      <p class="toc-title">Contents</p>
      <ul class="toc-list" id="toc">
        <!-- TOC will be populated by JavaScript -->
      </ul>
    </nav>

    {% if page.slides %}
    <div class="sidebar-section">
      <p class="toc-title">Slides</p>
      {% include pdf-preview.html
         title=page.slides_title
         thumbnail=page.slides_thumbnail
         pdf=page.slides %}
    </div>
    {% endif %}

    {% if page.notebooks %}
    <div class="sidebar-section">
      <p class="toc-title">Notebooks</p>
      {% for notebook in page.notebooks %}
        {% include notebook-launch.html
           title=notebook.title
           description=notebook.description
           notebook_path=notebook.path
           html_path=notebook.html %}
      {% endfor %}
    </div>
    {% endif %}
  </aside>

  <!-- Main Content -->
  <article class="content">
    {% if page.hero %}
    <div class="hero">
      <h1>{{ page.title }}</h1>
      {% if page.subtitle %}
      <p class="hero-subtitle">{{ page.subtitle }}</p>
      {% endif %}
      {% if page.hero_actions %}
      <div class="hero-actions">
        {% for action in page.hero_actions %}
        <a href="{{ action.url | relative_url }}" class="btn btn-{{ action.style | default: 'primary' }}">
          {{ action.text }}
        </a>
        {% endfor %}
      </div>
      {% endif %}
    </div>
    {% else %}
    <header class="page-header">
      <h1>{{ page.title }}</h1>
      {% if page.subtitle %}
      <p class="page-subtitle">{{ page.subtitle }}</p>
      {% endif %}
    </header>
    {% endif %}

    <!-- Learning Objectives -->
    {% if page.objectives %}
    <section class="section" id="objectives">
      <h2>Learning Objectives</h2>
      <p>After completing this module, you will be able to:</p>
      <ul>
        {% for objective in page.objectives %}
        <li>{{ objective }}</li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <!-- Main Content -->
    {{ content }}

    <!-- Related Resources -->
    {% if page.related %}
    <section class="section" id="related">
      <h2>Related Resources</h2>
      <div class="card-grid">
        {% for item in page.related %}
        <div class="card">
          <h4 class="card-title">{{ item.title }}</h4>
          <p class="card-description">{{ item.description }}</p>
          <a href="{{ item.url | relative_url }}" class="btn btn-sm btn-secondary">
            {{ item.action | default: 'Learn More' }}
          </a>
        </div>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- Bibliography -->
    {% if page.bibliography %}
    <section class="section" id="references">
      <h2>References</h2>
      <ol class="bibliography">
        {% for ref in page.bibliography %}
        <li id="ref-{{ ref.key }}">
          {{ ref.authors }} ({{ ref.year }}).
          <em>{{ ref.title }}</em>.
          {{ ref.venue }}.
          {% if ref.url %}
          <a href="{{ ref.url }}" target="_blank">[Link]</a>
          {% endif %}
        </li>
        {% endfor %}
      </ol>
    </section>
    {% endif %}
  </article>
</div>

<script>
// Build Table of Contents from h2 elements
document.addEventListener('DOMContentLoaded', function() {
  const toc = document.getElementById('toc');
  const headings = document.querySelectorAll('.content h2');

  headings.forEach(function(heading, index) {
    // Add ID if not present
    if (!heading.id) {
      heading.id = 'section-' + index;
    }

    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;
    li.appendChild(a);
    toc.appendChild(li);
  });

  // Reading progress
  const progressBar = document.querySelector('.progress-bar');
  window.addEventListener('scroll', function() {
    const scrollTop = window.scrollY;
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const progress = (scrollTop / docHeight) * 100;
    progressBar.style.width = progress + '%';
  });

  // Active TOC highlighting
  const tocLinks = document.querySelectorAll('.toc-list a');
  window.addEventListener('scroll', function() {
    let current = '';
    headings.forEach(function(heading) {
      const sectionTop = heading.offsetTop;
      if (scrollY >= sectionTop - 150) {
        current = heading.id;
      }
    });

    tocLinks.forEach(function(link) {
      link.classList.remove('active');
      if (link.getAttribute('href') === '#' + current) {
        link.classList.add('active');
      }
    });
  });
});
</script>
